---
applyTo: "**"
description: Kiki Packaging Backoffice - Project-specific AI Assistant Instructions
---

# Kiki Packaging Backoffice - Development Instructions

## CRITICAL: Always Check Implementation Status First

**Before creating, modifying, or implementing ANY feature:**

1. âœ… **ALWAYS read** `/docs/progress/implementation-status.md` first
2. âœ… **Verify** which features are already implemented (âœ…), in progress (â³), or not started (âŒ)
3. âœ… **Check dependencies** - ensure prerequisite features are completed before starting new ones
4. âœ… **Update status** immediately after completing a feature or starting work
5. âœ… **Follow the phase order** - don't skip ahead to Phase 5 if Phase 1 isn't complete

### Why This Matters

- Prevents duplicate work
- Ensures proper dependency order (e.g., auth before protected pages)
- Maintains accurate project tracking
- Avoids breaking existing implementations

---

## Project Context

### Purpose

Backoffice application for managing packaging orders at Kiki store. Users can:

- Log in with credentials
- Create orders for packaging products
- Track who ordered what and when
- View activity logs
- Manage packaging catalog (products)
- Manage users (admin only)

### Tech Stack

- **Frontend:** Nuxt 4.2.1 with TypeScript
- **UI Framework:** Nuxt UI 4.2.1 (Tailwind-based)
- **Validation:** Valibot (modern alternative to Zod)
- **State Management:** Nuxt's built-in `useState` (no Pinia)
- **Database:** TBD - Supabase or Azure Cosmos DB (check implementation-status.md)
- **Authentication:** JWT-based with access + refresh tokens
- **Internationalization:** Thai and English (static files via @nuxtjs/i18n)

---

## Development Rules

### 1. Implementation Workflow

**Before ANY code generation:**

```
1. Read /docs/progress/implementation-status.md
2. Identify which phase and feature you're working on
3. Verify prerequisites are complete
4. Check if feature is already partially implemented
5. Proceed with implementation
6. Update status in implementation-status.md
```

**After ANY code update/creation:**

```
1. IMMEDIATELY update /docs/progress/implementation-status.md
2. Change status from âŒ to â³ when starting work
3. Change status from â³ to âœ… when feature is complete
4. Add notes about implementation details if needed
5. Never skip this step - documentation must stay in sync with code
```

**This is MANDATORY - Always backtrack to docs after coding!**

### 2. Composable Best Practices (Vue 3 / Nuxt 4)

**CRITICAL RULES:**

- âœ… **ALWAYS** call composables at the **TOP LEVEL** of:

  - `setup()` function
  - Other composables
  - `<script setup>` block

- âŒ **NEVER** call composables inside:
  - Regular functions
  - Async functions
  - Callbacks (setTimeout, promises, etc)
  - Conditional blocks (if/else)
  - Loops (for/while)
  - Event handlers

**Example - CORRECT:**

```typescript
export const useOrders = () => {
  // All composables at top level
  const api = useApi();
  const router = useRouter();
  const toast = useToast();

  // Then use them in functions
  const createOrder = async (orderData) => {
    const result = await api.post("/orders", orderData);
    toast.success("Order created!");
    router.push(`/orders/${result.id}`);
  };

  return { createOrder };
};
```

**Example - WRONG:**

```typescript
export const useOrders = () => {
  const createOrder = async (orderData) => {
    const api = useApi(); // âŒ NEVER - breaks composable context
    const router = useRouter(); // âŒ NEVER
  };
};
```

### 3. Before Removing/Refactoring Code

**ALWAYS:**

1. Use `grep_search` to find all usages of the variable/function
2. Map dependencies - which functions use it?
3. Keep top-level composables even if removing functions
4. Verify with search - don't assume

### 4. File and Folder Organization

```
app/
â”œâ”€â”€ pages/           # Auto-routing pages
â”œâ”€â”€ layouts/         # Layout wrappers (default.vue, auth.vue)
â”œâ”€â”€ components/      # Reusable components
â”œâ”€â”€ composables/     # Business logic composables
â”œâ”€â”€ middleware/      # Route middleware (auth checks)
â”œâ”€â”€ stores/          # Pinia stores (if needed)
â”œâ”€â”€ utils/           # Utility functions
â”œâ”€â”€ types/           # TypeScript types/interfaces
â””â”€â”€ locales/         # i18n translations (when added)
    â”œâ”€â”€ en.json
    â””â”€â”€ th.json
```

### 5. Naming Conventions

- **Pages:** `kebab-case.vue` (e.g., `order-details.vue`)
- **Components:** `PascalCase.vue` (e.g., `OrderCard.vue`)
- **Composables:** `useCamelCase.ts` (e.g., `useOrders.ts`)
- **Stores:** `useCamelCaseStore.ts` (e.g., `useOrderStore.ts`)
- **Types:** `PascalCase.ts` (e.g., `Order.ts`, `User.ts`)

### 6. Authentication & Authorization

**Once implemented, follow these patterns:**

```typescript
// In pages that require auth
definePageMeta({
  middleware: "auth",
});

// In pages that require specific role
definePageMeta({
  middleware: ["auth", "admin-only"],
});
```

### 7. API/Database Patterns

**Use composables for all data operations:**

```typescript
// In pages/components
const { orders, loading, error, fetchOrders, createOrder } = useOrders();
```

**Never put API calls directly in components - always use composables.**

### 8. Internationalization (when added)

**Use translation keys, no fallbacks in production:**

```typescript
// âŒ WRONG
const message = t("orders.created") || "Order created!";

// âœ… CORRECT - ensure key exists in both en.json and th.json
const message = t("orders.created");
```

**Always add translations to BOTH language files:**

- `/app/locales/en.json`
- `/app/locales/th.json`

### 9. UI Components

**ALWAYS use Nuxt UI components first before creating custom ones:**

**Component Reference:** [Nuxt UI Documentation](https://ui.nuxt.com/docs/components)

**Available Components (Check docs before implementing):**

- **Forms:** `<UButton>`, `<UInput>`, `<UTextarea>`, `<USelect>`, `<UCheckbox>`, `<URadio>`, `<UToggle>`, `<URange>`, `<UForm>`, `<UFormField>`
- **Data:** `<UTable>`, `<UPagination>`, `<UBadge>`, `<UAvatar>`, `<UChip>`
- **Navigation:** `<UBreadcrumb>`, `<UTabs>`, `<UVerticalNavigation>`, `<UHorizontalNavigation>`, `<UCommandPalette>`
- **Overlay:** `<UModal>`, `<USlideOver>`, `<UPopover>`, `<UTooltip>`, `<UContextMenu>`
- **Layout:** `<UCard>`, `<UContainer>`, `<UDivider>`, `<USkeleton>`, `<UAccordion>`
- **Feedback:** `<UAlert>`, `<UProgress>`, `<UMeter>`, `<UNotifications>`
- **Media:** `<UCarousel>`, `<UIcon>`

**Workflow:**

1. âœ… **Check Nuxt UI docs first** - See if component exists at https://ui.nuxt.com/docs/components
2. âœ… **Use native Nuxt UI component** if available and suitable
3. âœ… **Customize with `:ui` prop** for styling needs
4. âœ… **Create wrapper component** (My\* prefix) only if:
   - Need app-specific defaults across multiple uses
   - Need to combine multiple Nuxt UI components
   - Native component doesn't fit use case

**Example - Use native first:**

```vue
<!-- âœ… GOOD - Use Nuxt UI directly -->
<UButton color="primary" @click="handleClick">Submit</UButton>

<!-- âœ… GOOD - Customize with :ui prop -->
<UButton :ui="{ rounded: 'rounded-full' }">Custom</UButton>

<!-- âœ… GOOD - Wrapper for app-wide consistency -->
<MyButton variant="submit">Submit</MyButton>
<!-- MyButton.vue wraps UButton with app defaults -->
```

**Common Components to Use:**

- Forms: Always check `UInput`, `USelect`, `UCheckbox` first
- Tables: Use `UTable` with pagination support
- Modals: Use `UModal` or `USlideOver`
- Cards: Use `UCard` with header/footer slots
- Alerts: Use `UAlert` for messages
- Loading: Use `USkeleton` for loading states

### 10. CSS & Theme Architecture (from Weight Wisdom)

**Tailwind CSS v4 with @theme directive:**

- âœ… Use modern `@theme` directive in CSS instead of `tailwind.config.js`
- âœ… Define custom variables in `/app/assets/css/theme.css`
- âœ… Implement fluid typography with `clamp()` for responsiveness
- ğŸ“ **Source:** `weight-wisdom-app/app/assets/css/theme.css`

**Color System:**

```css
/* Semantic color variables */
--color-status-error: #dc3545
--color-status-warning: #c69915
--color-status-success: #198754

/* Use in components */
bg-status-error, text-status-success
```

**Typography System:**

```css
/* Custom responsive size utilities */
--size-32: clamp(30px, 5vw, 34px);
--size-24: clamp(22px, 3vw, 26px);

/* Usage: text-size-32, text-size-24 */
```

**Multi-language Font Support:**

```vue
<!-- Dynamic font switching based on locale -->
<div :class="currentLocale === 'th' ? 'font-sukhumvit' : 'font-satoshi'">
```

**Modular CSS Structure:**

```
app/assets/css/
â”œâ”€â”€ main.css          # Central import hub
â”œâ”€â”€ colors.css        # Complete color system
â”œâ”€â”€ typography.css    # Font sizes & weights
â”œâ”€â”€ font-satoshi.css  # English font
â””â”€â”€ font-sukhumvit.css # Thai font
```

**Styling Patterns to Follow:**

1. **Use `ring-1 ring-gray-200` instead of `border`** - Softer appearance
2. **Generous rounded corners:** `rounded-2xl`, `rounded-3xl`
3. **Component wrappers:** Create `My*` components that wrap Nuxt UI with app-specific defaults
4. **:ui prop customization:** Deep customize Nuxt UI components inline
5. **Consistent spacing:** Use `gap-3`, `gap-4`, `p-4` pattern throughout
6. **Mobile-first:** Always consider `bg-gray-100` for pages, `bg-white` for cards
7. **Safe area support:** Use `pb-[env(safe-area-inset-bottom)]` for mobile

**Nuxt UI Theme Config (app.config.ts):**

```typescript
export default defineAppConfig({
  ui: {
    primary: "orange", // or your brand color
    gray: "neutral",
  },
});
```

**Icon Styling Pattern:**

```vue
<UIcon class="[&_path]:fill-primary" />
<UIcon class="[&_path]:fill-gray-600" />
```

### 11. Error Handling

**Always handle errors gracefully:**

```typescript
try {
  await createOrder(data);
  toast.success("Order created successfully");
} catch (error) {
  console.error("Order creation failed:", error);
  toast.error(error.message || "Failed to create order");
}
```

### 12. Loading States

**Always show loading states for async operations:**

```typescript
const loading = ref(false);

const fetchData = async () => {
  loading.value = true;
  try {
    // ... fetch data
  } finally {
    loading.value = false;
  }
};
```

---

## Reusable Patterns from Weight Wisdom App

Based on analysis of the Weight-Wisdom-App, we adopt these proven patterns:

### 1. **API Client Pattern (useApi composable)**

- âœ… Complete HTTP client with automatic token refresh
- âœ… Handles GET, POST, PUT, DELETE, file uploads
- âœ… Auto-retries on 401 with token refresh
- âœ… Type-safe with generics
- ğŸ“ **Source:** `weight-wisdom-app/app/composables/useApi.ts`

### 2. **Authentication Pattern**

- âœ… `useAuth` - Token management (localStorage)
- âœ… `useAuthRefresh` - Auto token refresh logic
- âœ… Global auth middleware for route protection
- âœ… JWT-based with access + refresh tokens
- ğŸ“ **Source:** `weight-wisdom-app/app/composables/useAuth.ts`, `useAuthRefresh.ts`, `middleware/auth.global.ts`

### 3. **State Management with useState**

- âœ… Use Nuxt's built-in `useState` instead of Pinia
- âœ… Simpler, no extra dependency
- âœ… Pattern: `useUserProfile`, `useCart` composables
- ğŸ“ **Example:** `weight-wisdom-app/app/composables/useUserProfile.ts`

### 4. **Form Validation with Valibot**

- âœ… Use **Valibot** (modern, lighter alternative to Zod)
- âœ… `useDebouncedValidation` for performance
- âœ… Schema-based with i18n error messages
- ğŸ“ **Source:** `weight-wisdom-app/app/composables/useDebouncedValidation.ts`
- ğŸ“¦ **Install:** `yarn add valibot`

### 5. **Toast Plugin**

- âœ… `$toast.success()`, `$toast.error()`
- âœ… Consistent UX for notifications
- ğŸ“ **Source:** `weight-wisdom-app/app/plugins/toast.client.ts`

### 6. **Reusable Form Components**

- âœ… MyButton, MyTextField, MySelect, MyCheckbox
- âœ… MyDatePickerField, MyToggle, MyOTP
- âœ… All built on Nuxt UI components
- ğŸ“ **Source:** `weight-wisdom-app/app/components/My*.vue`

### 7. **Global Auth Middleware**

- âœ… Checks authentication on every route
- âœ… Auto-redirects to login
- âœ… Handles token refresh
- âœ… Public routes whitelist
- ğŸ“ **Source:** `weight-wisdom-app/app/middleware/auth.global.ts`

### 8. **Component Library Structure**

- âœ… Organized in `/app/components/`
- âœ… Consistent naming (My prefix for custom components)
- âœ… Wrapper pattern around Nuxt UI base components
- ğŸ“ **Source:** `weight-wisdom-app/app/components/`

### 9. **CSS & Theme Architecture**

- âœ… Tailwind CSS v4 with `@theme` directive (no config file)
- âœ… Modular CSS structure (main.css, colors.css, typography.css)
- âœ… Fluid responsive typography with `clamp()`
- âœ… Semantic color variables (`--color-status-error`, etc.)
- âœ… Multi-language font support (dynamic switching)
- âœ… Custom size utilities (`text-size-32`, `text-size-24`)
- âœ… Ring utilities instead of borders (`ring-1 ring-gray-200`)
- âœ… Component wrapper pattern for consistent styling
- ğŸ“ **Source:** `weight-wisdom-app/app/assets/css/`

**Implementation Note:** Copy and adapt these patterns during Phase 1 setup before building features.

---

## Code Review Checklist

Before completing any feature, verify:

- [ ] Implementation status updated in `/docs/progress/implementation-status.md`
- [ ] Composables called at top level only
- [ ] Error handling implemented
- [ ] Loading states added
- [ ] TypeScript types defined
- [ ] No hardcoded strings (use i18n when available)
- [ ] Nuxt UI components used (not custom HTML)
- [ ] Auth middleware applied to protected pages
- [ ] Activity logging added (for trackable actions)
- [ ] Responsive design tested (mobile/tablet)
- [ ] No console errors or warnings

---

## Common Patterns

### Creating a New Page

1. Check `/docs/progress/implementation-status.md` for page status
2. Verify auth/middleware is implemented (if protected page)
3. Create page file in `/app/pages/`
4. Add page metadata (title, middleware)
5. Use composables for data fetching
6. Add loading/error states
7. Update implementation status

### Creating a New Composable

1. Check if similar composable exists
2. Create in `/app/composables/useName.ts`
3. Call all Vue/Nuxt composables at top level
4. Return reactive state and methods
5. Add TypeScript types
6. Document in code with JSDoc comments

### Adding a New Feature

1. **Read** `/docs/progress/implementation-status.md`
2. **Verify** prerequisites are complete
3. **Plan** the implementation
4. **Code** following these instructions
5. **Test** the feature
6. **Update** implementation status to âœ…

---

## Environment Variables (when set up)

Store in `.env` file (not committed to git):

```
# Database
DATABASE_URL=
DATABASE_KEY=

# Auth
AUTH_SECRET=
AUTH_ORIGIN=

# Other
NUXT_PUBLIC_APP_NAME=Kiki Packaging Backoffice
```

---

## Resources

- **Requirements:** `/docs/requirements.md`
- **Progress:** `/docs/progress/implementation-status.md`
- **Nuxt Docs:** https://nuxt.com/docs
- **Nuxt UI:** https://ui.nuxt.com/
- **TypeScript:** https://www.typescriptlang.org/docs/

---

## Remember

ğŸ¯ **Always check implementation status BEFORE starting work**
ğŸ¯ **Always update implementation status AFTER code changes**
ğŸ¯ **Follow the phase order - don't skip ahead**
ğŸ¯ **Backtrack to docs folder after every code update**
ğŸ¯ **Composables at top level only**
ğŸ¯ **Use Nuxt UI components**
ğŸ¯ **Handle errors and loading states**
